!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@odopod/odo-helpers"),require("tiny-emitter"),require("@odopod/odo-device")):"function"==typeof define&&define.amd?define(["@odopod/odo-helpers","tiny-emitter","@odopod/odo-device"],e):t.OdoPointer=e(t.OdoHelpers,t.TinyEmitter,t.OdoDevice)}(this,function(t,e,i){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,i=i&&i.hasOwnProperty("default")?i.default:i;var n={RIGHT:"right",LEFT:"left",UP:"up",DOWN:"down",NONE:"no_movement"},o={X:"x",Y:"y",BOTH:"xy"},s=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};function h(t){return t===o.X}function c(t){return t===o.Y}function d(t){return t===o.BOTH}function v(t){return t!==n.NONE}function u(t){return Number.isFinite(t)?t:0}function l(t,e,i,n,o){return t-e>0?i:t-e<0?n:o}function p(t,e){return Math.abs(t.x-e.x)>=Math.abs(t.y-e.y)?l(t.x,e.x,n.LEFT,n.RIGHT,n.NONE):l(t.y,e.y,n.UP,n.DOWN,n.NONE)}var E=function(){function e(i){var o,r,a,l,E,_,T,y;s(this,e),this.type=i.type,this.target=i.target,this.currentTarget=i.currentTarget,this.start=i.start,this.end=i.end,this.delta=i.delta,this.deltaTime=i.deltaTime,this.velocity=(o=this.deltaTime,r=this.delta.x,a=this.delta.y,new t.Coordinate(u(r/o),u(a/o))),this.currentVelocity=i.currentVelocity,this.distance=t.Coordinate.distance(i.start,i.end),this.direction=p(i.start,i.end),this.isDirectionOnAxis=(l=i.axis,E=this.direction,_=h(l)&&(E===n.LEFT||E===n.RIGHT),T=c(l)&&(E===n.UP||E===n.DOWN),y=d(l)&&v(E),_||T||y),this.didMoveOnAxis=function(t,e,i,n){return h(t)&&Math.abs(i)>0||c(t)&&Math.abs(n)>0||d(t)&&v(e)}(i.axis,this.direction,this.delta.x,this.delta.y),this.axisDirection=function(t,e,i){var n=Object.assign({},e),o=Object.assign({},i);return h(t)?(n.y=0,o.y=0):c(t)&&(n.x=0,o.x=0),p(n,o)}(i.axis,i.start,i.end),this.position=i.position,this.defaultPrevented=!1}return e.prototype.preventDefault=function(){this.defaultPrevented=!0},e}(),_=function(e){function n(o){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s(this,n);var h=a(this,e.call(this));if(!o||1!==o.nodeType)throw new TypeError("OdoPointer requires an element.");h.options=Object.assign({},n.Defaults,r),h.element=o,h.pageStart=new t.Coordinate,h.page=new t.Coordinate,h.delta=new t.Coordinate,h._lastPosition=new t.Coordinate,h._friction=1,h.hasDragged=!1,h._isLocked=!1,h._isDeactivated=!1,h._enabled=!0,h._velocityTrackerId=null,h.startTime=0,h.deltaTime=0,h._lastTime=0,h.velocity=new t.Coordinate,h._hasTrackedVelocity=!1,h.dragEventTarget=document;var c=n.TouchActionSupport[h.options.axis];return h._isTouchActionSupported=!!c,h.options.preventEventDefault&&h._isTouchActionSupported?h.element.style[c]=n.TouchAction[h.options.axis]:h.options.preventEventDefault&&i.HAS_TOUCH_EVENTS&&window.addEventListener(t.events.TOUCHMOVE,t.noop),h.listen(),h}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,e),n.prototype.listen=function(){this._onStart=this._handleDragStart.bind(this),i.HAS_POINTER_EVENTS?this.element.addEventListener(t.events.POINTERDOWN,this._onStart):(this.element.addEventListener(t.events.MOUSEDOWN,this._onStart),i.HAS_TOUCH_EVENTS&&this.element.addEventListener(t.events.TOUCHSTART,this._onStart)),this.element.addEventListener(t.events.DRAGSTART,n._preventDefault)},n.prototype.isXAxis=function(){return this.options.axis===n.Axis.X},n.prototype.isYAxis=function(){return this.options.axis===n.Axis.Y},n.prototype.isBothAxis=function(){return this.options.axis===n.Axis.BOTH},n.prototype.applyFriction=function(t){return t.scale(this.friction)},n.prototype._canStartDrag=function(t){return this.isEnabled&&(n.isTouchEvent(t)||0===t.button)},n.prototype._canContinueDrag=function(){return this.isEnabled&&!this._isDeactivated},n.prototype._handleDragStart=function(t){(clearInterval(this._velocityTrackerId),this._canStartDrag(t))&&(this._setDragStartValues(n._getPageCoordinate(t)),this._emitEvent(this._createEvent(n.EventType.START,t))||(this._addDragHandlers(t.type),this._velocityTrackerId=setInterval(this._trackVelocity.bind(this),n.VELOCITY_INTERVAL)))},n.prototype._handleDragMove=function(t){this._canContinueDrag()&&(this._setDragMoveValues(n._getPageCoordinate(t)),this._emitEvent(this._createEvent(n.EventType.MOVE,t))||!this.options.preventEventDefault||this._isTouchActionSupported||this._finishDragMove(t))},n.prototype._finishDragMove=function(t){this._maybeLock(),this._maybeDeactivate(),this._isLocked&&t.preventDefault(),this._isDeactivated&&(clearInterval(this._velocityTrackerId),this.velocity.x=0,this.velocity.y=0)},n.prototype._handleDragEnd=function(t){clearInterval(this._velocityTrackerId),this.deltaTime=Date.now()-this.startTime,this._hasTrackedVelocity||this._trackVelocity(),this._removeDragHandlers();var e=this._createEvent(n.EventType.END,t);e.isCancelEvent=n._isCancelEvent(t),this._emitEvent(e)&&t.preventDefault(),this.hasDragged=!1,this._isDeactivated=!1,this._isLocked=!1},n.prototype._setDragStartValues=function(e){this.pageStart=e,this.page=e,this._lastPosition=e,this.delta=new t.Coordinate,this.velocity=new t.Coordinate,this._hasTrackedVelocity=!1,this.startTime=Date.now(),this._lastTime=Date.now(),this.deltaTime=0},n.prototype._setDragMoveValues=function(e){var i=t.Coordinate.difference(e,this.page);this.applyFriction(i),this.delta.translate(i),this.page=e,this.deltaTime=Date.now()-this.startTime,this.hasDragged=!0},n.prototype._maybeLock=function(){this._isLocked||(this._isLocked=this._shouldLock(this.delta))},n.prototype._maybeDeactivate=function(){this._isDeactivated||(this._isDeactivated=this._shouldDeactivate(this.delta))},n.prototype._shouldLock=function(t){var e=this.isXAxis()&&Math.abs(t.x)>n.LOCK_THRESHOLD,i=this.isYAxis()&&Math.abs(t.y)>n.LOCK_THRESHOLD;return this.isBothAxis()||e||i},n.prototype._shouldDeactivate=function(t){var e=this.isXAxis()&&Math.abs(t.y)>n.DRAG_THRESHOLD,i=this.isYAxis()&&Math.abs(t.x)>n.DRAG_THRESHOLD;return!this._isLocked&&(this.isBothAxis()||e||i)},n.prototype._createEvent=function(t,e){return new n.Event({type:t,pointerId:this.id,currentTarget:this.element,target:e.target,axis:this.options.axis,deltaTime:this.deltaTime,delta:this.delta,start:this.pageStart,end:this.page,currentVelocity:this.velocity})},n.prototype._addDragHandlers=function(e){var i=this.dragEventTarget;switch(this._onMove=this._handleDragMove.bind(this),this._onEnd=this._handleDragEnd.bind(this),e){case t.events.POINTERDOWN:i.addEventListener(t.events.POINTERMOVE,this._onMove),i.addEventListener(t.events.POINTERUP,this._onEnd),i.addEventListener(t.events.POINTERCANCEL,this._onEnd);break;case t.events.MOUSEDOWN:i.addEventListener(t.events.MOUSEMOVE,this._onMove),i.addEventListener(t.events.MOUSEUP,this._onEnd);break;case t.events.TOUCHSTART:i.addEventListener(t.events.TOUCHMOVE,this._onMove),i.addEventListener(t.events.TOUCHEND,this._onEnd),i.addEventListener(t.events.TOUCHCANCEL,this._onEnd)}},n.prototype._removeDragHandlers=function(){var e=this.dragEventTarget;e.removeEventListener(t.events.POINTERMOVE,this._onMove),e.removeEventListener(t.events.POINTERUP,this._onEnd),e.removeEventListener(t.events.POINTERCANCEL,this._onEnd),e.removeEventListener(t.events.MOUSEMOVE,this._onMove),e.removeEventListener(t.events.MOUSEUP,this._onEnd),e.removeEventListener(t.events.TOUCHMOVE,this._onMove),e.removeEventListener(t.events.TOUCHEND,this._onEnd),e.removeEventListener(t.events.TOUCHCANCEL,this._onEnd)},n.prototype._trackVelocity=function(){var e=Date.now(),i=e-this._lastTime,o=t.Coordinate.difference(this.page,this._lastPosition);this.applyFriction(o),this._lastTime=e,this._lastPosition=this.page;var s=n.MAX_VELOCITY;this.velocity.x=t.clamp(o.x/i,-s,s),this.velocity.y=t.clamp(o.y/i,-s,s),this._hasTrackedVelocity=!0},n.prototype.hasVelocity=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.SWIPE_VELOCITY;return this.isYAxis()?Math.abs(t.y)>e:this.isXAxis()?Math.abs(t.x)>e:Math.abs(t.x)>e||Math.abs(t.y)>e},n.prototype._emitEvent=function(t){return this.emit(t.type,t),t.defaultPrevented},n.prototype.dispose=function(){clearInterval(this._velocityTrackerId),this._removeDragHandlers(),this.element.removeEventListener(t.events.POINTERDOWN,this._onStart),this.element.removeEventListener(t.events.MOUSEDOWN,this._onStart),this.element.removeEventListener(t.events.TOUCHSTART,this._onStart),this._isTouchActionSupported?this.element.style[n.TouchActionSupport[this.options.axis]]="":this.options.preventEventDefault&&i.HAS_TOUCH_EVENTS&&window.removeEventListener(t.events.TOUCHMOVE,t.noop),this.element=null,this.dragEventTarget=null},n.isTouchEvent=function(t){return!!t.changedTouches},n._isCancelEvent=function(e){return e.type===t.events.POINTERCANCEL||e.type===t.events.TOUCHCANCEL},n._getPageCoordinate=function(e){var i=void 0;return i=n.isTouchEvent(e)?e.changedTouches[0]:e,new t.Coordinate(i.pageX,i.pageY)},n._preventDefault=function(t){t.preventDefault()},r(n,[{key:"isEnabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"friction",get:function(){return this._friction},set:function(t){this._friction=t}}]),n}(e);return _.Direction=n,_.Axis=o,_.EventType={START:"odopointer:start",MOVE:"odopointer:move",END:"odopointer:end"},_.TouchActionSupport={x:i.prefixed("touchAction","pan-y"),y:i.prefixed("touchAction","pan-x"),xy:i.prefixed("touchAction","none")},_.TouchAction={x:"pan-y",y:"pan-x",xy:"none"},_.Defaults={axis:"xy",preventEventDefault:!0},_.MAX_VELOCITY=12,_.VELOCITY_INTERVAL=100,_.SWIPE_VELOCITY=.6,_.LOCK_THRESHOLD=6,_.DRAG_THRESHOLD=5,_.Event=E,_});
//# sourceMappingURL=odo-pointer.min.js.map
