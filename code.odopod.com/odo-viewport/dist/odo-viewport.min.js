!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@odopod/odo-window-events")):"function"==typeof define&&define.amd?define(["@odopod/odo-window-events"],e):t.OdoViewport=e(t.OdoWindowEvents)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),o=function(){function t(i,o){if(e(this,t),this.parent=o,this.id=Math.random().toString(36).substring(7),this.triggered=!1,this.threshold=200,this.isThresholdPercentage=!1,Object.assign(this,i),"function"!=typeof this.enter)throw new TypeError("Viewport.add :: No `enter` function provided in Viewport options.");this.parseThreshold(),this.hasExitCallback="function"==typeof this.exit,this.update()}return t.prototype.update=function(){var t=this.element.getBoundingClientRect();this.height=this.element.offsetHeight,this.width=this.element.offsetWidth,this.top=t.top+window.pageYOffset,this.left=t.left+window.pageXOffset,this.right=this.width+this.left,this.bottom=this.height+this.top},t.prototype.parseThreshold=function(){var t=this.threshold;this.threshold=parseFloat(t),"string"==typeof t&&t.indexOf("%")>-1?(this.isThresholdPercentage=!0,this.threshold=this.threshold/100):this.threshold<1&&this.threshold>0&&(this.isThresholdPercentage=!0)},t.prototype.dispose=function(){this.element=null,this.enter=null,this.exit=null,this.parent=null},i(t,[{key:"offset",get:function(){return this.isThresholdPercentage?this.threshold*this.parent.viewportHeight:this.threshold}}]),t}(),n=null;function r(t,e,i){return e<=t&&t<=i}return function(){function s(){e(this,s),this.addId=null,this.hasActiveHandlers=!1,this.items=new Map,this.viewportHeight=window.innerHeight,this.viewportWidth=document.documentElement.clientWidth,this.viewportTop=0,requestAnimationFrame(this.handleScroll.bind(this))}return s.prototype.bindEvents=function(){this.resizeId=t.onResize(this.update.bind(this)),this.scrollId=t.onFastScroll(this.handleScroll.bind(this)),this.hasActiveHandlers=!0},s.prototype.unbindEvents=function(){0===this.items.size&&(t.remove(this.resizeId),t.remove(this.scrollId),this.hasActiveHandlers=!1)},s.prototype.add=function(t){var e=new o(t,this);return this.items.set(e.id,e),this.hasActiveHandlers||this.bindEvents(),e.id},s.prototype.saveDimensions=function(){return this.items.forEach(function(t){t.update()}),this.viewportHeight=window.innerHeight,this.viewportWidth=document.documentElement.clientWidth,this},s.prototype.handleScroll=function(){return this.setScrollTop().process()},s.prototype.update=function(){return this.saveDimensions().process()},s.prototype.triggerEnter=function(t){t.enter.call(t.element,t),t.hasExitCallback?t.triggered=!0:(s.remove(t.id),this.unbindEvents())},s.prototype.triggerExit=function(t){t.exit.call(t.element,t),t.triggered=!1},s.prototype.setScrollTop=function(){return this.viewportTop=window.pageYOffset,this},s.prototype.process=function(){return this.items.forEach(this._processItem,this),this.addId=null,this},s.prototype._processItem=function(t){var e=this.isVisible(t),i=e&&this.isInViewport(t),o=e&&!t.hasExitCallback&&this.isTopPastViewport(t);t.triggered||!i&&!o?!i&&t.triggered&&t.hasExitCallback&&!this.isBottomInViewport(t)&&this.triggerExit(t):this.triggerEnter(t)},s.prototype.isInViewport=function(t){var e=this.isTopInViewport(t),i=void 0;i=t.offset>=0?!!t.triggered&&this.isBottomInViewport(t):this.isBottomInViewport(t);var o=this.isViewportPastBottom(t),n=!e&&!i&&this.doesSpanViewport(t),r=this.isSideInViewport(t);return(e||i||n)&&!o&&r},s.prototype.isSideInViewport=function(t){var e=r(t.left,0,this.viewportWidth),i=r(t.right,0,this.viewportWidth),o=t.width>=this.viewportWidth&&!e&&!i&&t.left<0&&t.right>this.viewportWidth;return e||i||o},s.prototype.isVisible=function(t){return!(0===t.width&&0===t.height)},s.prototype.isTopPastViewport=function(t){return this.viewportTop>t.top},s.prototype.isViewportPastBottom=function(t){return this.viewportTop>=t.bottom},s.prototype.isTopInViewport=function(t){return r(t.top+t.offset,this.viewportTop,this.viewportBottom)},s.prototype.isBottomInViewport=function(t){return r(t.bottom,this.viewportTop,this.viewportBottom)},s.prototype.doesSpanViewport=function(t){var e=t.top+t.offset,i=t.bottom;return t.height>=this.viewportHeight&&e<this.viewportTop&&i>this.viewportBottom},s.flush=function(){var t=s.getInstance();t.addId&&(cancelAnimationFrame(t.addId),t.addId=null),t.items.forEach(function(t,e){s.remove(e)}),t.items.clear(),t.unbindEvents()},s.add=function(t){var e=s.getInstance(),i=void 0;return i=Array.isArray(t)?t.map(function(t){return e.add(t)}):e.add(t),e.addId&&cancelAnimationFrame(e.addId),e.addId=requestAnimationFrame(e.process.bind(e)),i},s.remove=function(t){var e=s.getInstance();e.items.has(t)&&(e.items.get(t).dispose(),e.items.delete(t))},s.update=function(){s.getInstance().update()},s.getInstance=function(){return n||(n=new s),n},i(s,[{key:"viewportBottom",get:function(){return this.viewportTop+this.viewportHeight}}]),s}()});
//# sourceMappingURL=odo-viewport.min.js.map
